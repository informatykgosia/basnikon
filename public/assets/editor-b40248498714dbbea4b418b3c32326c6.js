function setup_wmd(a){return new WMDEditor(a)}(function(){function k(){var a={};return a.isIE=/msie/.test(j.userAgent.toLowerCase()),a.isIE_5or6=/msie 6/.test(j.userAgent.toLowerCase())||/msie 5/.test(j.userAgent.toLowerCase()),a.isIE_7plus=a.isIE&&!a.isIE_5or6,a.isOpera=/opera/.test(j.userAgent.toLowerCase()),a.isKonqueror=/konqueror/.test(j.userAgent.toLowerCase()),a}WMDEditor=function(a){this.options=WMDEditor.util.extend({},WMDEditor.defaults,a||{}),m(this,this.options),this.startEditor()},window.WMDEditor=WMDEditor,WMDEditor.defaults={version:2.1,output_format:"markdown",lineLength:40,button_bar:"wmd-button-bar",preview:"wmd-preview",output:"wmd-output",input:"wmd-input",imageDialogText:"<p style='margin-top: 0px'><b>Enter the image URL.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://i.imgur.com/1cZl4.jpg</p>",linkDialogText:"<p style='margin-top: 0px'><b>Enter the web address.</b></p><p>You can also add a title, which will be displayed as a tool tip.</p><p>Example:<br />http://www.google.com/</p>",imageDefaultText:"http://",linkDefaultText:"http://",imageDirectory:"images/",helpLink:"/wmd/markdownhelp.html",helpHoverTitle:"Markdown Syntax",helpTarget:"_blank",previewPollInterval:500,pastePollInterval:100,buttons:"bold italic  link blockquote code image  ol ul heading hr  undo redo help",autoFormatting:{list:!0,quote:!0,code:!0},modifierKeys:{bold:"b",italic:"i",link:"l",quote:"q",code:"k",image:"g",orderedList:"o",unorderedList:"u",heading:"h",horizontalRule:"r",redo:"y",undo:"z"},tagFilter:{enabled:!1,allowedTags:/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,patternLink:/^(<a\shref=("|')(\#\d+|(https?:\/\/|ftp:\/\/|mailto:)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+)\2(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,patternImage:/^(<img\ssrc="https?:(\/\/[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+)"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}},WMDEditor.prototype={getPanels:function(){return{buttonBar:typeof this.options.button_bar=="string"?document.getElementById(this.options.button_bar):this.options.button_bar,preview:typeof this.options.preview=="string"?document.getElementById(this.options.preview):this.options.preview,output:typeof this.options.output=="string"?document.getElementById(this.options.output):this.options.output,input:typeof this.options.input=="string"?document.getElementById(this.options.input):this.options.input}},startEditor:function(){this.panels=this.getPanels(),this.previewMgr=new f(this),edit=new this.editor(this.previewMgr.refresh),this.previewMgr.refresh(!0)}};var a={isVisible:function(a){return a.offsetWidth>0||a.offsetHeight>0},addEvent:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},removeEvent:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},fixEolChars:function(a){return a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a},extendRegExp:function(a,b,c){if(b===null||b===undefined)b="";if(c===null||c===undefined)c="";var d=a.toString(),e="",f=d.match(/\/([gim]*)$/);return f===null?e=f[0]:e="",d=d.replace(/(^\/|\/[gim]*$)/g,""),d=b+d+c,new RegExp(d,e)},createImage:function(a){var b=imageDirectory+a,c=document.createElement("img");return c.className="wmd-button",c.src=b,c},prompt:function(c,d,e,f){var g,h,i,k,m;d===undefined&&(d="");var n=function(a){var b=a.charCode||a.keyCode;b===27&&o(!0)},o=function(b){a.removeEvent(document.body,"keydown",n);var c=i.value+(k.value?' "'+k.value+'"':"");return b?c=null:(c=c.replace("http://http://","http://"),c=c.replace("http://https://","https://"),c=c.replace("http://ftp://","ftp://"),f=="link"&&m.checked&&(c="!"+c)),g.parentNode.removeChild(g),h.parentNode.removeChild(h),e(c),!1},p=function(){h=document.createElement("div"),h.className="wmd-prompt-background",style=h.style,style.position="absolute",style.top="0",style.zIndex="10000",l.isKonqueror?style.backgroundColor="transparent":l.isIE?style.filter="alpha(opacity=50)":style.opacity="0.5";var a=b.getPageSize();style.height=a[1]+"px",l.isIE?(style.left=document.documentElement.scrollLeft,style.width=document.documentElement.clientWidth):(style.left="0",style.width="100%"),document.body.appendChild(h)},q=function(){g=document.createElement("div"),g.className="wmd-prompt-dialog",g.style.padding="10px;",g.style.position="fixed",g.style.width="400px",g.style.zIndex="10001";var e=document.createElement("div");e.innerHTML=c,e.style.padding="5px",g.appendChild(e);var h=document.createElement("form");h.onsubmit=function(){return o(!1)};var p=h.style;p.padding="0",p.margin="0",p.cssFloat="left",p.width="100%",p.textAlign="center",p.position="relative",g.appendChild(h);var q=document.createElement("label");p=q.style,p.display="block",p.width="80%",p.marginLeft=p.marginRight="auto",p.textAlign="left",h.appendChild(q),q.appendChild(document.createTextNode(f+" URL:")),i=document.createElement("input"),i.type="text",i.value=d,p=i.style,p.display="block",p.width="100%",p.marginLeft=p.marginRight="auto",q.appendChild(i),q=document.createElement("label"),p=q.style,p.display="block",p.width="80%",p.marginLeft=p.marginRight="auto",p.textAlign="left",h.appendChild(q),q.appendChild(document.createTextNode(f+" Title (Hover Text):")),k=document.createElement("input"),k.type="text",p=k.style,p.display="block",p.width="100%",p.marginLeft=p.marginRight="auto",q.appendChild(k),f=="link"&&(q=document.createElement("label"),p=q.style,p.display="block",p.textAlign="center",h.appendChild(q),m=document.createElement("input"),m.type="checkbox",m.value="!",q.appendChild(m),q.appendChild(document.createTextNode(" Have this link open in a new window")));var r=document.createElement("input");r.type="button",r.onclick=function(){return o(!1)},r.value="OK",p=r.style,p.margin="10px",p.display="inline",p.width="7em";var s=document.createElement("input");s.type="button",s.onclick=function(){return o(!0)},s.value="Cancel",p=s.style,p.margin="10px",p.display="inline",p.width="7em",/mac/.test(j.platform.toLowerCase())?(h.appendChild(s),h.appendChild(r)):(h.appendChild(r),h.appendChild(s)),a.addEvent(document.body,"keydown",n),g.style.top="50%",g.style.left="50%",g.style.display="block",l.isIE_5or6&&(g.style.position="absolute",g.style.top=document.documentElement.scrollTop+200+"px",g.style.left="50%"),document.body.appendChild(g),g.style.marginTop=-(b.getHeight(g)/2)+"px",g.style.marginLeft=-(b.getWidth(g)/2)+"px"};p(),window.setTimeout(function(){q();var a=d.length;if(i.selectionStart!==undefined)i.selectionStart=0,i.selectionEnd=a;else if(i.createTextRange){var b=i.createTextRange();b.collapse(!1),b.moveStart("character",-a),b.moveEnd("character",a),b.select()}i.focus()},0)},extend:function(){function a(b,c){for(var d in c)c.hasOwnProperty(d)&&(typeof b[d]=="object"&&typeof c[d]=="object"?a(b[d],c[d]):b[d]=c[d]);return b}var b={};for(var c=0;c<arguments.length;c++)a(b,arguments[c]);return b}},b={getTop:function(a,b){var c=a.offsetTop;if(!b)while(a=a.offsetParent)c+=a.offsetTop;return c},getHeight:function(a){return a.offsetHeight||a.scrollHeight},getWidth:function(a){return a.offsetWidth||a.scrollWidth},getPageSize:function(){var a,b,c,d;self.innerHeight&&self.scrollMaxY?(a=document.body.scrollWidth,b=self.innerHeight+self.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(a=document.body.scrollWidth,b=document.body.scrollHeight):(a=document.body.offsetWidth,b=document.body.offsetHeight),self.innerHeight?(c=self.innerWidth,d=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):document.body&&(c=document.body.clientWidth,d=document.body.clientHeight);var e=Math.max(a,c),f=Math.max(b,d);return[e,f,c,d]}},c=function(b,c){var e=this,f=b;this.init=function(){if(!a.isVisible(f))return;this.setInputAreaSelectionStartEnd(),this.scrollTop=f.scrollTop;if(!this.text&&f.selectionStart||f.selectionStart===0)this.text=f.value},this.setInputAreaSelection=function(){if(!a.isVisible(f))return;if(f.selectionStart!==undefined&&!l.isOpera)f.focus(),f.selectionStart=e.start,f.selectionEnd=e.end,f.scrollTop=e.scrollTop;else if(document.selection){if(typeof document.activeElement!="unknown"&&document.activeElement&&document.activeElement!==f)return;f.focus();var b=f.createTextRange();b.moveStart("character",-f.value.length),b.moveEnd("character",-f.value.length),b.moveEnd("character",e.end),b.moveStart("character",e.start),b.select()}},this.setInputAreaSelectionStartEnd=function(){if(f.selectionStart||f.selectionStart===0)e.start=f.selectionStart,e.end=f.selectionEnd;else if(document.selection){e.text=a.fixEolChars(f.value);var b;c.ieRetardedClick&&c.ieCachedRange?(b=c.ieCachedRange,c.ieRetardedClick=!1):b=document.selection.createRange();var d=a.fixEolChars(b.text),g="",h=g+d+g;b.text=h;var i=a.fixEolChars(f.value);b.moveStart("character",-h.length),b.text=d,e.start=i.indexOf(g),e.end=i.lastIndexOf(g)-g.length;var j=e.text.length-a.fixEolChars(f.value).length;if(j){b.moveStart("character",-d.length);while(j--)d+="\n",e.end+=1;b.text=d}this.setInputAreaSelection()}},this.restore=function(){e.text!=undefined&&e.text!=f.value&&(f.value=e.text),this.setInputAreaSelection(),f.scrollTop=e.scrollTop},this.getChunks=function(){var b=new d;return b.before=a.fixEolChars(e.text.substring(0,e.start)),b.startTag="",b.selection=a.fixEolChars(e.text.substring(e.start,e.end)),b.endTag="",b.after=a.fixEolChars(e.text.substring(e.end)),b.scrollTop=e.scrollTop,b},this.setChunks=function(a){a.before=a.before+a.startTag,a.after=a.endTag+a.after,l.isOpera&&(a.before=a.before.replace(/\n/g,"\r\n"),a.selection=a.selection.replace(/\n/g,"\r\n"),a.after=a.after.replace(/\n/g,"\r\n")),this.start=a.before.length,this.end=a.before.length+a.selection.length,this.text=a.before+a.selection+a.after,this.scrollTop=a.scrollTop},this.init()},d=function(){};d.prototype.findTags=function(b,c){var d=this,e;b&&(e=a.extendRegExp(b,"","$"),this.before=this.before.replace(e,function(a){return d.startTag=d.startTag+a,""}),e=a.extendRegExp(b,"^",""),this.selection=this.selection.replace(e,function(a){return d.startTag=d.startTag+a,""})),c&&(e=a.extendRegExp(c,"","$"),this.selection=this.selection.replace(e,function(a){return d.endTag=a+d.endTag,""}),e=a.extendRegExp(c,"^",""),this.after=this.after.replace(e,function(a){return d.endTag=a+d.endTag,""}))},d.prototype.trimWhitespace=function(a){this.selection=this.selection.replace(/^(\s*)/,""),a||(this.before+=i.$1),this.selection=this.selection.replace(/(\s*)$/,""),a||(this.after=i.$1+this.after)},d.prototype.addBlankLines=function(a,b,c){a===undefined&&(a=1),b===undefined&&(b=1),a++,b++;var d,e,f=/(^\n*)/.exec(this.selection);this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+(f?f[1]:""),f=/(\n*$)/.exec(this.selection),this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+(f?f[1]:""),f=/(^\n*)/.exec(this.startTag),this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+(f?f[1]:""),f=/(\n*$)/.exec(this.endTag),this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+(f?f[1]:"");if(this.before){d=e="";while(a--)d+="\\n?",e+="\n";c&&(d="\\n*"),this.before=this.before.replace(new i(d+"$",""),e)}if(this.after){d=e="";while(b--)d+="\\n?",e+="\n";c&&(d="\\n*"),this.after=this.after.replace(new i(d,""),e)}};var e=function(b,c,d){var e=this,f=b,g,h,i,j;this.tick=function(){if(!a.isVisible(f))return;if(f.selectionStart||f.selectionStart===0){var b=f.selectionStart,c=f.selectionEnd;if(b!=g||c!=h){g=b,h=c;if(i!=f.value)return i=f.value,!0}}return!1};var k=function(){if(!a.isVisible(f))return;e.tick()&&c()},l=function(){j=window.setInterval(k,d)};this.destroy=function(){window.clearInterval(j)},l()},f=function(c){var d=this,f,g,h,i,j,k,m=3e3,n="delayed",o=function(b,d){a.addEvent(b,"input",d),b.onpaste=d,b.ondrop=d,a.addEvent(b,"keypress",d),a.addEvent(b,"keydown",d),g=new e(c.panels.input,d,c.options.previewPollInterval)},p=function(){var a=0;return window.innerHeight?a=window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&(a=document.body.scrollTop),a},q=function(){if(!c.panels.preview&&!c.panels.output)return;var a=c.panels.input.value;if(a&&a==j)return;j=a;var b=(new Date).getTime();!f&&c.showdown&&(f=new c.showdown.converter),f&&(a=f.makeHtml(a));var d=(new Date).getTime();i=d-b,v(a),k=a},r=function(){h&&(window.clearTimeout(h),h=undefined);if(n!=="manual"){var a=0;n==="delayed"&&(a=i),a>m&&(a=m),h=window.setTimeout(q,a)}},s=function(a){return a.scrollHeight<=a.clientHeight?1:a.scrollTop/(a.scrollHeight-a.clientHeight)},t=function(){c.panels.preview&&(c.panels.preview.scrollTop=(c.panels.preview.scrollHeight-c.panels.preview.clientHeight)*s(c.panels.preview)),c.panels.output&&(c.panels.output.scrollTop=(c.panels.output.scrollHeight-c.panels.output.clientHeight)*s(c.panels.output))};this.refresh=function(a){a?(j="",q()):r()},this.processingTime=function(){return i},this.output=function(){return k},this.setUpdateMode=function(a){n=a,d.refresh()};var u=!0,v=function(a){var d=b.getTop(c.panels.input)-p();if(c.panels.output)if(c.panels.output.value!==undefined)c.panels.output.value=a;else{var e=a.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;"),c.panels.output.innerHTML="<pre><code>"+e+"</code></pre>"}c.panels.preview&&(c.options.tagFilter.enabled&&(a=a.replace(/<[^<>]*>?/gi,function(a){return a.match(c.options.tagFilter.allowedTags)||a.match(c.options.tagFilter.patternLink)||a.match(c.options.tagFilter.patternImage)?a:""})),c.panels.preview.innerHTML=a),t();if(u){u=!1;return}var f=b.getTop(c.panels.input)-p();l.isIE?window.setTimeout(function(){window.scrollBy(0,f-d)},0):window.scrollBy(0,f-d)},w=function(){o(c.panels.input,r),q(),c.panels.preview&&(c.panels.preview.scrollTop=0),c.panels.output&&(c.panels.output.scrollTop=0)};this.destroy=function(){g&&g.destroy()},w()},g=function(b,d,f,g){var h=this,i=[],j=0,k="none",m,n,o,p,q=function(a,b){k!=a&&(k=a,b||s()),!l.isIE||k!="moving"?o=window.setTimeout(r,1):p=null},r=function(){p=new c(d,b),n.tick(),o=undefined};this.setCommandMode=function(){k="command",s(),o=window.setTimeout(r,0)},this.canUndo=function(){return j>1},this.canRedo=function(){return i[j+1]?!0:!1},this.undo=function(){h.canUndo()&&(m?(m.restore(),m=null):(i[j]=new c(d,b),i[--j].restore(),g&&g())),k="none",d.focus(),r()},this.redo=function(){h.canRedo()&&(i[++j].restore(),g&&g()),k="none",d.focus(),r()};var s=function(){var a=p||new c(d,b);if(!a)return!1;if(k=="moving"){m||(m=a);return}m&&(i[j-1].text!=m.text&&(i[j++]=m),m=null),i[j++]=a,i[j+1]=null,g&&g()},t=function(a){var b=!1;if(a.ctrlKey||a.metaKey){var c=a.charCode||a.keyCode,d=String.fromCharCode(c);switch(d){case"y":h.redo(),b=!0;break;case"z":a.shiftKey?h.redo():h.undo(),b=!0}}if(b){a.preventDefault&&a.preventDefault(),window.event&&(window.event.returnValue=!1);return}},u=function(a){if(!a.ctrlKey&&!a.metaKey){var b=a.keyCode;b>=33&&b<=40||b>=63232&&b<=63235?q("moving"):b==8||b==46||b==127?q("deleting"):b==13?q("newlines"):b==27?q("escape"):(b<16||b>20)&&b!=91&&q("typing")}},v=function(){a.addEvent(d,"keypress",function(a){(a.ctrlKey||a.metaKey)&&(a.keyCode==89||a.keyCode==90)&&a.preventDefault()});var b=function(){(l.isIE||p&&p.text!=d.value)&&o==undefined&&(k="paste",s(),r())};n=new e(d,b,f),a.addEvent(d,"keydown",t),a.addEvent(d,"keydown",u),a.addEvent(d,"mousedown",function(){q("moving")}),d.onpaste=b,d.ondrop=b},w=function(){v(),r(),s()};this.destroy=function(){n&&n.destroy()},w()};WMDEditor.util=a,WMDEditor.position=b,WMDEditor.TextareaState=c,WMDEditor.InputPoller=e,WMDEditor.PreviewManager=f,WMDEditor.UndoManager=g;var h=window.document,i=window.RegExp,j=window.navigator,l=k(),m=function(a,b){a.Command={},a.Global={},a.buttons={},a.showdown=window.Showdown;var d=WMDEditor.util,e=WMDEditor.position,f=a.Command;a.ieCachedRange=null,a.ieRetardedClick=!1,a.editor=function(e){e||(e=function(){});var h=a.panels.input,i=0,k=this,m,n,o,p,q,r=function(b){h.focus();if(b.textOp){q&&q.setCommandMode();var d=new c(a.panels.input,a);if(!d)return;var f=d.getChunks(),g=function(){h.focus(),f&&d.setChunks(f),d.restore(),e()},i=!0,j=b.textOp(f,g,i);j||g()}b.execute&&b.execute(k)},s=function(){q&&(a.buttons["wmd-undo-button"]&&t(a.buttons["wmd-undo-button"],q.canUndo()),a.buttons["wmd-redo-button"]&&t(a.buttons["wmd-redo-button"],q.canRedo()))},t=function(b,c){c?(b.className=b.className.replace(new RegExp("(^|\\s+)disabled(\\s+|$)")," "),l.isIE&&(b.onmousedown=function(){a.ieRetardedClick=!0,a.ieCachedRange=document.selection.createRange()}),b.isHelp||(b.onclick=function(){return this.onmouseout&&this.onmouseout(),r(this),!1})):(b.className+=(b.className?" ":"")+"disabled",b.onmouseover=b.onmouseout=b.onclick=function(){})},u=function(){function k(b,c,d){var e=document.createElement("li");return a.buttons[b]=e,e.className="wmd-button "+b,e.XShift=i+"px",i-=20,c&&(e.title=c),d&&(e.textOp=d),e}function l(a,b,c){var d=k(a,b,c);return t(d,!0),h.appendChild(d),d}function m(){var a=document.createElement("li");return a.className="wmd-spacer",h.appendChild(a),a}var c=typeof b.button_bar=="string"?document.getElementById(b.button_bar||"wmd-button-bar"):b.button_bar,d="0px",e="-20px",g="-40px",h=document.createElement("ul");h.className="wmd-button-row",h=c.appendChild(h);var i=0,n=b.buttons.split(" ");for(var o=0;o<n.length;o++)switch(n[o]){case"bold":l("wmd-bold-button","Strong <strong> Ctrl+B",f.doBold);break;case"italic":l("wmd-italic-button","Emphasis <em> Ctrl+I",f.doItalic);break;case"link":l("wmd-link-button","Hyperlink <a> Ctrl+L",function(a,b,c){return f.doLinkOrImage(a,b,!1)});break;case"blockquote":l("wmd-quote-button","Blockquote <blockquote> Ctrl+Q",f.doBlockquote);break;case"code":l("wmd-code-button","Code Sample <pre><code> Ctrl+K",f.doCode);break;case"image":l("wmd-image-button","Image <img> Ctrl+G",function(a,b,c){return f.doLinkOrImage(a,b,!0)});break;case"ol":l("wmd-olist-button","Numbered List <ol> Ctrl+O",function(a,b,c){f.doList(a,b,!0,c)});break;case"ul":l("wmd-ulist-button","Bulleted List <ul> Ctrl+U",function(a,b,c){f.doList(a,b,!1,c)});break;case"heading":l("wmd-heading-button","Heading <h1>/<h2> Ctrl+H",f.doHeading);break;case"hr":l("wmd-hr-button","Horizontal Rule <hr> Ctrl+R",f.doHorizontalRule);break;case"undo":var p=l("wmd-undo-button","Undo - Ctrl+Z");p.execute=function(a){a.undo()};break;case"redo":var q=l("wmd-redo-button","Redo - Ctrl+Y");/win/.test(j.platform.toLowerCase())?q.title="Redo - Ctrl+Y":q.title="Redo - Ctrl+Shift+Z",q.execute=function(a){a.redo()};break;case"help":var r=k("wmd-help-button");r.isHelp=!0,t(r,!0),h.appendChild(r);var u=document.createElement("a");u.href=b.helpLink,u.target=b.helpTarget,u.title=b.helpHoverTitle,r.appendChild(u);break;case"":m()}s()},v=function(){/\?noundo/.test(document.location.href)&&(a.nativeUndo=!0),a.nativeUndo||(q=new g(a,a.panels.input,a.options.pastePollInterval,function(){e(),s()})),u();var b="keydown";l.isOpera&&(b="keypress"),d.addEvent(h,b,function(b){if(a.options.modifierKeys&&(b.ctrlKey||b.metaKey)){var c=b.charCode||b.keyCode,d=String.fromCharCode(c).toLowerCase();switch(d){case a.options.modifierKeys.bold:if(!a.buttons["wmd-bold-button"])return;r(a.buttons["wmd-bold-button"]);break;case a.options.modifierKeys.italic:if(!a.buttons["wmd-italic-button"])return;r(a.buttons["wmd-italic-button"]);break;case a.options.modifierKeys.link:if(!a.buttons["wmd-link-button"])return;r(a.buttons["wmd-link-button"]);break;case a.options.modifierKeys.quote:if(!a.buttons["wmd-quote-button"])return;r(a.buttons["wmd-quote-button"]);break;case a.options.modifierKeys.code:if(!a.buttons["wmd-code-button"])return;r(a.buttons["wmd-code-button"]);break;case a.options.modifierKeys.image:if(!a.buttons["wmd-image-button"])return;r(a.buttons["wmd-image-button"]);break;case a.options.modifierKeys.orderedList:if(!a.buttons["wmd-olist-button"])return;r(a.buttons["wmd-olist-button"]);break;case a.options.modifierKeys.unorderedList:if(!a.buttons["wmd-ulist-button"])return;r(a.buttons["wmd-ulist-button"]);break;case a.options.modifierKeys.heading:if(!a.buttons["wmd-heading-button"])return;r(a.buttons["wmd-heading-button"]);break;case a.options.modifierKeys.horizontalRule:if(!a.buttons["wmd-hr-button"])return;r(a.buttons["wmd-hr-button"]);break;case a.options.modifierKeys.redo:if(!a.buttons["wmd-redo-button"])return;r(a.buttons["wmd-redo-button"]);break;case a.options.modifierKeys.undo:if(b.shiftKey){if(!a.buttons["wmd-redo-button"])return;r(a.buttons["wmd-redo-button"])}else{if(!a.buttons["wmd-undo-button"])return;r(a.buttons["wmd-undo-button"])}break;default:return}b.preventDefault&&b.preventDefault(),window.event&&(window.event.returnValue=!1)}}),d.addEvent(h,"keyup",function(a){if(!a.shiftKey&&!a.ctrlKey&&!a.metaKey){var b=a.charCode||a.keyCode;b===13&&(fakeButton={},fakeButton.textOp=f.doAutoindent,r(fakeButton))}}),l.isIE&&d.addEvent(h,"keydown",function(a){var b=a.keyCode;if(b===27)return!1})};this.undo=function(){q&&q.undo()},this.redo=function(){q&&q.redo()};var w=function(){v()};this.destroy=function(){q&&q.destroy(),o.parentNode&&o.parentNode.removeChild(o),h&&(h.style.marginTop=""),window.clearInterval(p)},w()},f.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",f.unwrap=function(a){var b=new i("([^\\n])\\n(?!(\\n|"+f.prefixes+"))","g");a.selection=a.selection.replace(b,"$1 $2")},f.wrap=function(a,b){f.unwrap(a);var c=new i("(.{1,"+b+"})( +|$\\n?)","gm");a.selection=a.selection.replace(c,function(a,b){return(new i("^"+f.prefixes,"")).test(a)?a:b+"\n"}),a.selection=a.selection.replace(/\s+$/,"")},f.doBold=function(a,b,c){return f.doBorI(a,2,"strong text")},f.doItalic=function(a,b,c){return f.doBorI(a,1,"emphasized text")},f.doBorI=function(a,b,c){a.trimWhitespace(),a.selection=a.selection.replace(/\n{2,}/g,"\n"),a.before.search(/(\**$)/);var d=i.$1;a.after.search(/(^\**)/);var e=i.$1,f=Math.min(d.length,e.length);if(f>=b&&(f!=2||b!=1))a.before=a.before.replace(i("[*]{"+b+"}$",""),""),a.after=a.after.replace(i("^[*]{"+b+"}",""),"");else if(!a.selection&&e){a.after=a.after.replace(/^([*_]*)/,""),a.before=a.before.replace(/(\s?)$/,"");var g=i.$1;a.before=a.before+e+g}else{!a.selection&&!e&&(a.selection=c);var h=b<=1?"*":"**";a.before=a.before+h,a.after=h+a.after}return},f.stripLinkDefs=function(a,b){return a=a.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(a,c,d,e,f){return b[c]=a.replace(/\s*$/,""),e?(b[c]=a.replace(/["(](.+?)[")]$/,""),e+f):""}),a},f.addLinkDef=function(a,b){var c=0,d={};a.before=f.stripLinkDefs(a.before,d),a.selection=f.stripLinkDefs(a.selection,d),a.after=f.stripLinkDefs(a.after,d);var e="",g=/(\[(?:\[[^\]]*\]|[^\[\]])*\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,h=function(a){c++,a=a.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+c+"]:"),e+="\n"+a},i=function(a,b,e,f){return d[e]?(h(d[e]),b+c+f):a};a.before=a.before.replace(g,i),b?h(b):a.selection=a.selection.replace(g,i);var j=c;return a.after=a.after.replace(g,i),a.after&&(a.after=a.after.replace(/\n*$/,"")),a.after||(a.selection=a.selection.replace(/\n*$/,"")),a.after+="\n\n"+e,j},f.doLinkOrImage=function(a,c,e){a.trimWhitespace(),a.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);if(!(a.endTag.length>1)){if(/\n\n/.test(a.selection)){f.addLinkDef(a,null);return}var g=function(b){console.log(b);if(b!==null){a.startTag=a.endTag="";var d=" [999]: "+b,g=f.addLinkDef(a,d);a.startTag=e?"![":"[",a.endTag="]["+g+"]",a.selection||(e?a.selection="alt text":a.selection="link text")}c()};return e?d.prompt(b.imageDialogText,b.imageDefaultText,g,"Image"):d.prompt(b.linkDialogText,b.linkDefaultText,g,"Link"),!0}a.startTag=a.startTag.replace(/!?\[/,""),a.endTag="",f.addLinkDef(a,null)},f.doAutoindent=function(b,c,d){if(!a.options.autoFormatting)return;a.options.autoFormatting.list&&(b.before=b.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n")),a.options.autoFormatting.quote&&(b.before=b.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n")),a.options.autoFormatting.code&&(b.before=b.before.replace(/(\n|^)[ \t]+\n$/,"\n\n")),d=!1,/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(b.before)&&f.doList&&a.options.autoFormatting.list&&f.doList(b,c,!1,!0),/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(b.before)&&f.doList&&a.options.autoFormatting.list&&f.doList(b,c,!0,!0),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(b.before)&&f.doBlockquote&&a.options.autoFormatting.quote&&f.doBlockquote(b,c,d),/(\n|^)(\t|[ ]{4,}).*\n$/.test(b.before)&&f.doCode&&a.options.autoFormatting.code&&f.doCode(b,c,d)},f.doBlockquote=function(a,c,d){a.selection=a.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(b,c,d,e){return a.before+=c,a.after=e+a.after,d}),a.before=a.before.replace(/(>[ \t]*)$/,function(b,c){return a.selection=c+a.selection,""});var e=d?"Blockquote":"";a.selection=a.selection.replace(/^(\s|>)+$/,""),a.selection=a.selection||e,a.before&&(a.before=a.before.replace(/\n?$/,"\n")),a.after&&(a.after=a.after.replace(/^\n?/,"\n")),a.before=a.before.replace(/(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*$)/,function(b){return a.startTag=b,""}),a.after=a.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(b){return a.endTag=b,""});var g=function(b){var c=b?"> ":"";a.startTag&&(a.startTag=a.startTag.replace(/\n((>|\s)*)\n$/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"})),a.endTag&&(a.endTag=a.endTag.replace(/^\n((>|\s)*)\n/,function(a,b){return"\n"+b.replace(/^[ ]{0,3}>?[ \t]*$/gm,c)+"\n"}))};/^(?![ ]{0,3}>)/m.test(a.selection)?(f.wrap(a,b.lineLength-2),a.selection=a.selection.replace(/^/gm,"> "),g(!0),a.addBlankLines()):(a.selection=a.selection.replace(/^[ ]{0,3}> ?/gm,""),f.unwrap(a),g(!1),!/^(\n|^)[ ]{0,3}>/.test(a.selection)&&a.startTag&&(a.startTag=a.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(a.selection)&&a.endTag&&(a.endTag=a.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(a.selection)||(a.selection=a.selection.replace(/^(> *)/,function(b,c){return a.startTag+=c,""}))},f.doCode=function(a,b,c){var d=/\S[ ]*$/.test(a.before),e=/^[ ]*\S/.test(a.after);if(!e&&!d||/\n/.test(a.selection)){a.before=a.before.replace(/[ ]{4}$/,function(b){return a.selection=b+a.selection,""});var f=1,g=1;if(/\n(\t|[ ]{4,}).*\n$/.test(a.before)||a.after==="")f=0;/^\n(\t|[ ]{4,})/.test(a.after)&&(g=0),a.addBlankLines(f,g),a.selection?/^[ ]{0,3}\S/m.test(a.selection)?a.selection=a.selection.replace(/^/gm,"    "):a.selection=a.selection.replace(/^[ ]{4}/gm,""):(a.startTag="    ",a.selection=c?"enter code here":"")}else a.trimWhitespace(),a.findTags(/`/,/`/),!a.startTag&&!a.endTag?(a.startTag=a.endTag="`",a.selection||(a.selection=c?"enter code here":"")):a.endTag&&!a.startTag?(a.before+=a.endTag,a.endTag=""):a.startTag=a.endTag=""},f.doList=function(a,c,d,e){var g=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,h=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,j="-",k=1,l=function(){var a;return d?(a=" "+k+". ",k++):a=" "+j+" ",a},m=function(a){return d===undefined&&(d=/^\s*\d/.test(a)),a=a.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(a){return l()}),a};a.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),a.before&&!/\n$/.test(a.before)&&!/^\n/.test(a.startTag)&&(a.before+=a.startTag,a.startTag="");if(a.startTag){var n=/\d+[.]/.test(a.startTag);a.startTag="",a.selection=a.selection.replace(/\n[ ]{4}/g,"\n"),f.unwrap(a),a.addBlankLines(),n&&(a.after=a.after.replace(h,m));if(d==n)return}var o=1;a.before=a.before.replace(g,function(a){return/^\s*([*+-])/.test(a)&&(j=i.$1),o=/[^\n]\n\n[^\n]/.test(a)?1:0,m(a)}),a.selection||(a.selection=e?"List item":" ");var p=l(),q=1;a.after=a.after.replace(h,function(a){return q=/[^\n]\n\n[^\n]/.test(a)?1:0,m(a)}),a.trimWhitespace(!0),a.addBlankLines(o,q,!0),a.startTag=p;var r=p.replace(/./g," ");f.wrap(a,b.lineLength-r.length),a.selection=a.selection.replace(/\n/g,"\n"+r)},f.doHeading=function(a,c,d){a.selection=a.selection.replace(/\s+/g," "),a.selection=a.selection.replace(/(^\s+|\s+$)/g,"");if(!a.selection){a.startTag="## ",a.selection="Heading",a.endTag=" ##";return}var e=0;a.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(a.startTag)&&(e=i.lastMatch.length),a.startTag=a.endTag="",a.findTags(null,/\s?(-+|=+)/),/=+/.test(a.endTag)&&(e=1),/-+/.test(a.endTag)&&(e=2),a.startTag=a.endTag="",a.addBlankLines(1,1);var f=e==0?2:e-1;if(f>0){var g=f>=2?"-":"=",h=a.selection.length;h>b.lineLength&&(h=b.lineLength),a.endTag="\n";while(h--)a.endTag+=g}},f.doHorizontalRule=function(a,b,c){a.startTag="----------\n",a.selection="",a.addBlankLines(2,1,!0)}}})(),Showdown={},Showdown.converter=function(){var a,b,c,d=0;this.makeHtml=function(d){return a=[],b=[],c=[],d=d.replace(/~/g,"~T"),d=d.replace(/\$/g,"~D"),d=d.replace(/\r\n/g,"\n"),d=d.replace(/\r/g,"\n"),d="\n\n"+d+"\n\n",d=F(d),d=d.replace(/^[ \t]+$/mg,""),d=f(d),d=e(d),d=h(d),d=D(d),d=d.replace(/~D/g,"$$"),d=d.replace(/~T/g,"~"),d=d.replace(/https?\:\/\/[^"\s<>]*[^.,;'">\:\s<>\)\]\!]/g,function(a,b){var c=d.slice(Math.max(0,d.lastIndexOf("\n",b)),b),e=d.slice(b);return c.match(/<([a-z]+)\s[^>]+>?$/)&&e.match(/^[^>]*>/)?a:"<a href='"+a+"'>"+a+"</a>"}),d=d.replace(/[a-z0-9_\-+=.]+@[a-z0-9\-]+(\.[a-z0-9\-]+)+/ig,function(a,b,c){var e=d.slice(Math.max(0,d.lastIndexOf("\n",c)),c);return e.match(/<([a-z]+)\s[^>]+>?$/)||e.match(/mailto\:$/)?a:"<a href='mailto:"+a+"'>"+a+"</a>"}),d};var e=function(c){return c=c.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(c,d,e,f,g){return d=d.toLowerCase(),a[d]=y(e),f?f+g:(g&&(b[d]=g.replace(/"/g,"&quot;")),"")}),c},f=function(a){a=a.replace(/\n/g,"\n\n");var b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",c="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,g),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,g),a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,g),a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,g),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,g),a=a.replace(/\n\n/g,"\n"),a},g=function(a,b){var d=b;return d=d.replace(/\n\n/g,"\n"),d=d.replace(/^\n/,""),d=d.replace(/\n+$/g,""),d="\n\n~K"+(c.push(d)-1)+"K\n\n",d},h=function(a){a=o(a);var b=s("<hr />");return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=q(a),a=r(a),a=w(a),a=f(a),a=x(a),a},i=function(a){return a=t(a),a=j(a),a=A(a),a=m(a),a=k(a),a=B(a),a=y(a),a=z(a),a=v(a),a=a.replace(/ {2,}\n/g," <br />\n"),a},j=function(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=G(b,"\\`*_"),b}),a},k=function(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,l),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,l),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,l),a},l=function(c,d,e,f,g,h,i,j){j===undefined&&(j="");var k=d,l=e,m=f.toLowerCase(),n=g,o=j,p=!1;if(n===""){m===""?m=l.toLowerCase().replace(/ ?\n/g," "):m[0]=="!"&&(p=!0,m=m.substr(1)),n="#"+m;if(a[m]!==undefined)n=a[m],b[m]!==undefined&&(o=b[m]),n[0]=="!"&&(p=!0,n=n.substr(1));else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}}else n[0]=="!"&&(p=!0,n=n.substr(1));n=G(n,"*_");var q='<a href="'+n+'"';return o!==""&&(o=o.replace(/"/g,"&quot;"),o=G(o,"*_"),q+=' title="'+o+'"'),p&&(q+=' target="_blank"'),q+=">"+l+"</a>",q},m=function(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,n),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,n),a},n=function(c,d,e,f,g,h,i,j){var k=d,l=e,m=f.toLowerCase(),n=g,o=j;o||(o="");if(n===""){m===""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(a[m]===undefined)return k;n=a[m],b[m]!==undefined&&(o=b[m])}l=l.replace(/"/g,"&quot;"),n=G(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=o.replace(/"/g,"&quot;"),o=G(o,"*_"),p+=' title="'+o+'"',p+=" />",p},o=function(a){return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return s("<h1>"+i(b)+"</h1>")}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,
b){return s("<h2>"+i(b)+"</h2>")}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){var d=b.length;return s("<h"+d+">"+i(c)+"</h"+d+">")}),a},p,q=function(a){a+="~0";var b=/^(([ ]{0,3}([*+\-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+\-]|\d+[.])[ \t]+)))/gm;return d?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+\-]/g)>-1?"ul":"ol";d=d.replace(/\n{2,}/g,"\n\n\n");var f=p(d);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n",f}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+\-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+\-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+\-]/g)>-1?"ul":"ol";f=f.replace(/\n{2,}/g,"\n\n\n");var h=p(f);return h=e+"<"+g+">\n"+h+"</"+g+">\n",h})),a=a.replace(/~0/,""),a};p=function(a){return d++,a=a.replace(/\n{2,}$/,"\n"),a+="~0",a=a.replace(/(\n)?(^[ \t]*)([*+\-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+\-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){var f=e,g=b,j=c;return g||f.search(/\n{2,}/)>-1?f=h(E(f)):(f=q(E(f)),f=f.replace(/\n$/,""),f=i(f)),"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),d--,a};var r=function(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=u(E(d)),d=F(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>",s(d)+e}),a=a.replace(/~0/,""),a},s=function(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(c.push(a)-1)+"K\n\n"},t=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=u(f),b+"<code>"+f+"</code>"}),a=a.replace(/(^|[^\\])(\^{2})([^\r]*?[^\^]{2})\2(?!\^)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=u(f),b+"<sup>"+f+"</sup>"}),a=a.replace(/(^|[^\\])(,{2})([^\r]*?[^,]{2})\2(?!,)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=u(f),b+"<sub>"+f+"</sub>"}),a=a.replace(/(^|[^\\])(~T~T)([^\r]*?[^~]{2})\2(?!~)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=u(f),b+"<strike>"+f+"</strike>"}),a},u=function(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/\u2026/g,"&hellip;").replace(/\u00AB/g,"&laquo;").replace(/\u00BB/g,"&raquo;").replace(/\u201C/g,"&ldquo;").replace(/\u201D/g,"&rdquo;").replace(/\u2018/g,"&lsquo;").replace(/\u2019/g,"&rsquo;").replace(/\u2014/g,"&mdash;").replace(/\u2013/g,"&ndash;").replace(/\u2022/g,"&bull;").replace(/\u2122/g,"&trade;").replace(/\u00A9/g,"&copy;").replace(/\u00AE/g,"&reg;"),a=G(a,"*_{}[]\\",!1),a},v=function(a){return a=a.replace(/(\*\*)(?=\S)([^\r]*?\S[*]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\w)_(\w)/g,"$1~E95E$2"),a=a.replace(/(\*)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>"),a=a.replace(/(_)(?=\S)([^\r]*?\S)\1/g,"<u>$2</u>"),a},w=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=h(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^ {2}/mg,"~0"),c=c.replace(/~0/g,""),c}),s("<blockquote>\n"+c+"\n</blockquote>")}),a},x=function(a){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");var b,d=a.split(/\n{2,}/g),e=[],f=d.length;for(b=0;b<f;b++){var g=d[b],h="<p>";g.search(/~K(\d+)K/g)>=0?e.push(g):g.search(/\S/)>=0&&(g=i(g),g.substr(0,2)==="->"&&(g.substr(-5)==="&lt;-"?(h='<p align="center">',g=g.slice(2,-5)):(h='<p align="right">',g=g.substring(2))),g=g.replace(/\n/g,"<br />"),g=g.replace(/^([ \t]*)/g,h),g+="</p>",e.push(g))}f=e.length;for(b=0;b<f;b++)while(e[b].search(/~K(\d+)K/)>=0){var j=c[RegExp.$1];j=j.replace(/\$/g,"$$$$"),e[b]=e[b].replace(/~K\d+K/,j)}return e.join("\n\n")},y=function(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),a=a.replace(/\u2026/g,"&hellip;").replace(/\u00AB/g,"&laquo;").replace(/\u00BB/g,"&raquo;").replace(/\u201C/g,"&ldquo;").replace(/\u201D/g,"&rdquo;").replace(/\u2018/g,"&lsquo;").replace(/\u2019/g,"&rsquo;").replace(/\u2014/g,"&mdash;").replace(/\u2013/g,"&ndash;").replace(/\u2022/g,"&bull;").replace(/\u2122/g,"&trade;").replace(/\u00A9/g,"&copy;").replace(/\u00AE/g,"&reg;"),a},z=function(a){return a=a.replace(/\.\.\./g,"&hellip;").replace(/\(c\)/g,"&copy;").replace(/\(r\)/g,"&reg;").replace(/\(tm\)/g,"&trade;").replace(/\-\-/g,"&mdash;"),a},A=function(a){return a=a.replace(/\\(\\)/g,H),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,H),a},B=function(a){return a=a.replace(/(?:")<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),a=a.replace(/<(?:mailto:)?([\-.\w]+\@[\-a-z0-9]+(\.[\-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return C(D(b))}),a},C=function(a){function b(a){var b="0123456789ABCDEF",c=a.charCodeAt(0);return b.charAt(c>>4)+b.charAt(c&15)}var c=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+b(a)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if(a=="@")a=c[Math.floor(Math.random()*2)](a);else if(a!=":"){var b=Math.random();a=b>.9?c[2](a):b>.45?c[1](a):c[0](a)}return a}),a='<a href="'+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">'),a},D=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b,10);return String.fromCharCode(c)}),a},E=function(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,""),a},F=function(a){return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b,c){var d=b,e=4-d.length%4;for(var f=0;f<e;f++)d+=" ";return d}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,""),a},G=function(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,H),a},H=function(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}},$(function(){new WMDEditor({input:"editor-input",button_bar:"editor-button-bar",preview:"editor-preview"})});